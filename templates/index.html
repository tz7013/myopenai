<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - Material Messaging App Concept</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Montserrat'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css'>
  <link rel="stylesheet" href="./style.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<!-- partial:index.partial.html -->
<body>
  <div class="container">
    <div class="row">
      <nav class="menu">
        <ul class="items">
          <li class="item">
            <i class="fa fa-home" aria-hidden="true"></i>
          </li>
          <li class="item">
            <i class="fa fa-user" aria-hidden="true"></i>
          </li>
          <li class="item">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </li>
          <li class="item item-active">
            <i class="fa fa-commenting" aria-hidden="true"></i>
          </li>
          <li class="item">
            <i class="fa fa-file" aria-hidden="true"></i>
          </li>
          <li class="item">
            <i class="fa fa-cog" aria-hidden="true"></i>
          </li>
        </ul>
      </nav>

      <section class="discussions">
        <div class="discussion search">
          <div class="searchbar">
            <i class="fa fa-search" aria-hidden="true"></i>
            <input type="text" placeholder="Search..."></input>
          </div>
        </div>
        <div class="discussion message-active">
          <div class="photo" style="background-image: url(https://i.ibb.co/RGXDyZz/img-a-Vt-Nep-Jf-QDFNml-EUc-Jpg-VH6h.jpg);">
            <div class="online"></div>
          </div>
          <div class="desc-contact">
            <p class="name">OPENAI</p>
            <p class="message">9 pm at the bar if possible ğŸ˜³</p>
          </div>
          <div class="timer">12 sec</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(http://e0.365dm.com/16/08/16-9/20/theirry-henry-sky-sports-pundit_3766131.jpg?20161212144602);">
            <div class="online"></div>
          </div>
          <div class="desc-contact">
            <p class="name">Dave Corlew</p>
            <p class="message">Let's meet for a coffee or something today ?</p>
          </div>
          <div class="timer">3 min</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(https://images.unsplash.com/photo-1497551060073-4c5ab6435f12?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=667&q=80);">
          </div>
          <div class="desc-contact">
            <p class="name">Jerome Seiber</p>
            <p class="message">I've sent you the annual report</p>
          </div>
          <div class="timer">42 min</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(http://thomasdaubenton.xyz/portfolio/images/photo.jpg);">
            <div class="online"></div>
          </div>
          <div class="desc-contact">
            <p class="name">Thomas Dbtn</p>
            <p class="message">See you tomorrow ! ğŸ™‚</p>
          </div>
          <div class="timer">2 hour</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(https://images.unsplash.com/photo-1553514029-1318c9127859?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=700&q=80);">
          </div>
          <div class="desc-contact">
            <p class="name">Elsie Amador</p>
            <p class="message">What the f**k is going on ?</p>
          </div>
          <div class="timer">1 day</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(https://images.unsplash.com/photo-1541747157478-3222166cf342?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=967&q=80);">
          </div>
          <div class="desc-contact">
            <p class="name">Billy Southard</p>
            <p class="message">Ahahah ğŸ˜‚</p>
          </div>
          <div class="timer">4 days</div>
        </div>

        <div class="discussion">
          <div class="photo" style="background-image: url(https://images.unsplash.com/photo-1435348773030-a1d74f568bc2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1050&q=80);">
            <div class="online"></div>
          </div>
          <div class="desc-contact">
            <p class="name">Paul Walker</p>
            <p class="message">You can't see me</p>
          </div>
          <div class="timer">1 week</div>
        </div>
      </section>
      <section class="chat">
        <div class="header-chat">
          <i class="icon fa fa-user-o" aria-hidden="true"></i>
          <p class="name">OPENAI</p>
          <i class="icon clickable fa fa-ellipsis-h right" aria-hidden="true"></i>
        </div>

        <!-- å°è©±è¦–çª—æ¡†-->
        <div id="chat", class="messages-chat", style="height: 530px;overflow-y: auto;">
                  
          <!--å·¦é‚Šè¨Šæ¯æ¬„ä½-->
          <div class="message">
            <div class="photo" style="background-image: url(https://i.ibb.co/RGXDyZz/img-a-Vt-Nep-Jf-QDFNml-EUc-Jpg-VH6h.jpg);">
              <div class="online"></div>
            </div>
            <p class="text"> æ‚¨å¥½, æœ‰ä»€éº¼å¯ä»¥å¹«åŠ©æ‚¨çš„? </p>
          </div>
          <p class="time"> 14:58</p>

          <!--å³é‚Šè¨Šæ¯æ¬„ä½-->
          <!-- <div class="message text-only">
            <div class="response">
              <p class="text"> Hey Megan ! It's been a while ğŸ˜ƒ</p>
            </div>
          </div>
          <p class="response-time time"> 15:04</p> --> 

        <div class="footer-chat">

          <i class="icon fa fa-smile-o clickable" style="font-size:25pt;" aria-hidden="true"></i>
          <!--æ–°å¢è¨Šæ¯æ¬„çš„æ¨™ç±¤id="message"-->
          <input id="message" type="text" class="write-message" placeholder="Type your message here"></input>
          <!--æ–°å¢æŒ‰éˆ•çš„æ¨™ç±¤id="send"-->  
          <i id="send" class="icon send fa fa-paper-plane-o clickable" aria-hidden="true"></i>
        </div>
      </section>
    </div>
  </div>
</body>
<!-- partial -->
  <script  src="./script.js"></script>
  <script>
    // æ–°å¢ç¶²é è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œäº‹ä»¶å‚¾è½å™¨, ç¢ºèªç¶²é è¼‰å…¥å®Œæˆå¾Œæ‰æœ‰DOMå¯ä»¥ç”¨
    document.addEventListener('DOMContentLoaded', function() {
      // æ‰“v1/chat APIèˆ‡OpenAIèŠå¤©
      function chat(msg)
      {
        axios.get('/v1/chat?msg=' + msg)
          .then(function(response) {
            // hanfle success
            console.log(msg);
            console.log(response);
            if(response.data.indexOf('https://') == 0)
              addLeftImage(response.data)
            else
              addLeftMessage(response.data);
          })
          .catch(function(error) {
            // handle error
            console.log(error)
          })
          .finally(function () {
            // always executed
          });
      }
      // function addLeftImag(msg)
      // {
      //   let chat = document.getElementById('chat');

      //   // å»ºç«‹æ–°çš„å…ƒç´ 
      //   let div1 = document.createElement('div');
      //   // å¹«æ–°çš„å…ƒç´ åŠ ä¸Šclasså±¬æ€§
      //   div1.classList.add('message')

      //   let div2 = document.createElement('div');
      //   div2.classList.add('photo')
      //   // å¹«æ–°çš„å…ƒç´ è¨­å®šæ¨£å¼
      //   div2.style = "min-width: 45px; background-image: url('https://i.ibb.co/RGXDyZz/img-a-Vt-Nep-Jf-QDFNml-EUc-Jpg-VH6h.jpg');"

      //   let div3 = document.createElement('div');
      //   div3.classList.add('online')

      //   let img = document.createElement('img');
      //   img.style = 'width: 100%; margin-bottom: 10px';
        
      //   let p2 = document.createElement('p');
      //   p2.classList.add('time');
      //   let time_node = document.createTextNode("14:00");
      //   p2.appendChild(time_node);

      //   // æ•´åˆ
      //   div2.appendChild(div3);
      //   div1.appendChild(div2);
      //   div1.appendChild(p1);

      //   // å°‡å…ƒç´ æ–°å¢åˆ°ç¶²é ä¸Š
      //   chat.appendChild(div1);
      //   chat.appendChild(p2);

      //   // æ²å‹•è¨Šæ¯æœ€æ–°ä¸€å‰‡
      //   chat.scrollTo(0, chat.scrollHeight);
      // }

      function addLeftImage(addr) {
        // å–å¾—èŠå¤©å®¤çˆ¶å…ƒç´ 
        let chat = document.getElementById('chat');

        // å»ºç«‹æ–°çš„å…ƒç´ 
        let img = document.createElement('img');
        img.src = addr;
        img.style = "width: 100%; margin-bottom: 10px;";

        chat.appendChild(img);

        // æ²å‹•è¨Šæ¯æœ€æ–°ä¸€å‰‡
        chat.scrollTo(0, chat.scrollHeight);
      }

      function addLeftMessage(msg)
      {
        // å–å¾—èŠå¤©å®¤çˆ¶å…ƒç´ 
        let chat = document.getElementById('chat');
        // å»ºç«‹æ–°çš„å…ƒç´ 
        let div1 = document.createElement('div');
        // å¹«æ–°çš„å…ƒç´ åŠ ä¸Šclasså±¬æ€§
        div1.classList.add('message')

        let div2 = document.createElement('div');
        div2.classList.add('photo')
        // å¹«æ–°çš„å…ƒç´ è¨­å®šæ¨£å¼
        div2.style = "min-width: 45px; background-image: url('https://i.ibb.co/RGXDyZz/img-a-Vt-Nep-Jf-QDFNml-EUc-Jpg-VH6h.jpg');"

        let div3 = document.createElement('div');
        div3.classList.add('online')

        let p1 = document.createElement('pre');
        // p1.classList.add('text');
        p1.classList.add('text');
        p1.style = 'white-space: pre-wrap';
        // å»ºç«‹æ¨™ç±¤å…§çš„æ–‡å­—node
        let msg_node = document.createTextNode(msg);
        // å°‡æ–‡å­—nodeè¨­å®šçµ¦éœ€è¦çš„æ¨™ç±¤
        p1.appendChild(msg_node);

        let p2 = document.createElement('p');
        p2.classList.add('time');
        let time_node = document.createTextNode("14:00");
        p2.appendChild(time_node);

        // æ•´åˆ
        div2.appendChild(div3);
        div1.appendChild(div2);
        div1.appendChild(p1);

        // å°‡å…ƒç´ æ–°å¢åˆ°ç¶²é ä¸Š
        chat.appendChild(div1);
        chat.appendChild(p2);

        // æ²å‹•è¨Šæ¯æœ€æ–°ä¸€å‰‡
        chat.scrollTo(0, chat.scrollHeight);
      }

      function addRightMessage(msg)
      {
        // å–å¾—èŠå¤©å®¤çˆ¶å…ƒç´ 
        let chat = document.getElementById('chat');
        // å»ºç«‹æ–°çš„å…ƒç´ 
        let div1 = document.createElement('div');
        // å¹«æ–°çš„å…ƒç´ åŠ ä¸Šclasså±¬æ€§
        div1.classList.add('message');
        div1.classList.add('text-only');

        let div2 = document.createElement('div');
        div2.classList.add('response');

        let p1 = document.createElement('p');
        p1.classList.add('text');
        // å»ºç«‹æ¨™ç±¤å…§çš„æ–‡å­—node
        let msg_node = document.createTextNode(msg);
        // å°‡æ–‡å­—nodeè¨­å®šçµ¦éœ€è¦çš„æ¨™ç±¤
        p1.appendChild(msg_node);
        
        let p2 = document.createElement('p');
        p2.classList.add('response-time');
        p2.classList.add('time');
        let time_node = document.createTextNode("14:00");
        p2.appendChild(time_node);

        // æ•´åˆ
        div1.appendChild(div2);
        div1.appendChild(p1);

        // å°‡å…ƒç´ æ–°å¢åˆ°ç¶²é ä¸Š
        chat.appendChild(div1);
        chat.appendChild(p2);
        
        chat.scrollTo(0, chat.scrollHeight);
      }
    
      let message_input = document.getElementById('message');

      message_input.addEventListener('keydown', function(event){
        if(event.key == 'Enter'){
          // alert('Enterè¢«æŒ‰ä¸‹äº†: ' + message_input.value);
          addRightMessage(message_input.value);
          chat(message_input.value);
          message_input.value = ''
        }
      });

      // å–å¾—id=sendé€™å€‹æ¨™ç±¤
      let send_btn = document.getElementById('send');
      // å¹«sendæ¨™ç±¤åŠ ä¸Šé»æ“Šäº‹ä»¶å‚¾è½å™¨, è™•ç†é»æ“Šè¦åšçš„äº‹æƒ…
      send_btn.addEventListener('click', function(){
        // alert('æŒ‰éˆ•è¢«é»é›†äº†: ' + message_input.value);
        chat(message_input.value);
        addRightMessage(message_input.value);
        message_input.value = ''
      });
    });
  </script>

</body>
</html>
